<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link href="http://fonts.googleapis.com/css?family=Rosarivo:400,400italic|Happy+Monkey|Electrolize" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Packet.html">
<link rel="next" href="Peg.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Arp" rel="Chapter" href="Arp.html">
<link title="Browser" rel="Chapter" href="Browser.html">
<link title="Clock" rel="Chapter" href="Clock.html">
<link title="Dhcp" rel="Chapter" href="Dhcp.html">
<link title="Dhcpd" rel="Chapter" href="Dhcpd.html">
<link title="Dns" rel="Chapter" href="Dns.html">
<link title="Eth" rel="Chapter" href="Eth.html">
<link title="Host" rel="Chapter" href="Host.html">
<link title="Html" rel="Chapter" href="Html.html">
<link title="Http" rel="Chapter" href="Http.html">
<link title="Hub" rel="Chapter" href="Hub.html">
<link title="Icmp" rel="Chapter" href="Icmp.html">
<link title="Ip" rel="Chapter" href="Ip.html">
<link title="Localhost" rel="Chapter" href="Localhost.html">
<link title="Log" rel="Chapter" href="Log.html">
<link title="Metric" rel="Chapter" href="Metric.html">
<link title="Myadmin" rel="Chapter" href="Myadmin.html">
<link title="Net" rel="Chapter" href="Net.html">
<link title="Opache" rel="Chapter" href="Opache.html">
<link title="Packet" rel="Chapter" href="Packet.html">
<link title="Pcap" rel="Chapter" href="Pcap.html">
<link title="Peg" rel="Chapter" href="Peg.html">
<link title="Persist" rel="Chapter" href="Persist.html">
<link title="Router" rel="Chapter" href="Router.html">
<link title="Sim" rel="Chapter" href="Sim.html">
<link title="Sll" rel="Chapter" href="Sll.html">
<link title="Tcp" rel="Chapter" href="Tcp.html">
<link title="Tools" rel="Chapter" href="Tools.html">
<link title="Udp" rel="Chapter" href="Udp.html">
<link title="Url" rel="Chapter" href="Url.html">
<link title="Vlan" rel="Chapter" href="Vlan.html"><link title="Libpcap low level wrappers" rel="Section" href="#2_Libpcaplowlevelwrappers">
<link title="Packet injection" rel="Section" href="#2_Packetinjection">
<link title="Packet sniffing" rel="Section" href="#2_Packetsniffing">
<link title="Pcap files" rel="Section" href="#2_Pcapfiles">
<link title="Tools" rel="Section" href="#2_Tools">
<link title="Captured packet" rel="Subsection" href="#3_Capturedpacket">
<title>Pcap</title>
</head>
<body>
<div class="navbar"><a href="Packet.html">Previous</a>
&nbsp;<a href="index.html">Up</a>
&nbsp;<a href="Peg.html">Next</a>
</div>
<center><h1>Module <a href="type_Pcap.html">Pcap</a></h1></center>
<br>
<pre><span class="keyword">module</span> Pcap: <code class="code"><span class="keyword">sig</span></code> <a href="Pcap.html">..</a> <code class="code"><span class="keyword">end</span></code></pre> This module holds all functions related to <code class="code">libpcap</code>, packet sniffing,
 packet injection and pcap file reading and writing.<br>
<hr width="100%">
<pre><span id="VALdebug"><span class="keyword">val</span> <a href="code_VALPcap.debug.html">debug</a></span> : <code class="type">bool</code></pre><br>
<span id="2_Libpcaplowlevelwrappers"><h2>Libpcap low level wrappers</h2></span><br>
<pre><span id="TYPEiface"><span class="keyword">type</span> <code class="type"></code>iface</span> </pre>
<div class="info">
A network device opened for sniffing or injection<br>
</div>

<pre><span id="VALopenif"><span class="keyword">val</span> <a href="code_VALPcap.openif.html">openif</a></span> : <code class="type">string -> bool -> string -> int -> <a href="Pcap.html#TYPEiface">iface</a></code></pre><div class="info">
<code class="code">openif <span class="string">"eth0"</span> <span class="keyword">true</span> <span class="string">"port 80"</span> 96</code> returns the iface representing eth0,
 in promiscuous mode, filtering port 80 and capturing only the first 96 bytes
 of each packets. Notice that if <code class="code">caplen</code> is set to 0 then a "default" value
 of 65535 will be chosen, which is probably not what you want. You should set
 <code class="code">caplen</code> = your <em>MTU</em> size.<br>
</div>
<pre><span id="VALinject"><span class="keyword">val</span> <a href="code_VALPcap.inject.html">inject</a></span> : <code class="type"><a href="Pcap.html#TYPEiface">iface</a> -> string -> unit</code></pre><div class="info">
<code class="code">inject iface packet</code> inject this packet into this interface<br>
</div>
<pre><span id="VALsniff"><span class="keyword">val</span> <a href="code_VALPcap.sniff.html">sniff</a></span> : <code class="type"><a href="Pcap.html#TYPEiface">iface</a> -> Clock.Time.t * string</code></pre><div class="info">
<code class="code">sniff iface</code> will return the next available packet, as well as its capture
 timestamp<br>
</div>
<br>
<span id="2_Packetinjection"><h2>Packet injection</h2></span><br>
<pre><span id="VALpackets_injected_ok"><span class="keyword">val</span> <a href="code_VALPcap.packets_injected_ok.html">packets_injected_ok</a></span> : <code class="type"><a href="Metric.Atomic.html#TYPEt">Metric.Atomic.t</a></code></pre><div class="info">
A counter for how many packets were injected successfully.<br>
</div>
<pre><span id="VALpackets_injected_err"><span class="keyword">val</span> <a href="code_VALPcap.packets_injected_err.html">packets_injected_err</a></span> : <code class="type"><a href="Metric.Atomic.html#TYPEt">Metric.Atomic.t</a></code></pre><div class="info">
A counter for how many packets we failed to inject.<br>
</div>
<pre><span id="VALbytes_out"><span class="keyword">val</span> <a href="code_VALPcap.bytes_out.html">bytes_out</a></span> : <code class="type"><a href="Metric.Counter.html#TYPEt">Metric.Counter.t</a></code></pre><div class="info">
A counter for how many bytes were injected successfully.<br>
</div>
<pre><span id="VALinject_pdu"><span class="keyword">val</span> <a href="code_VALPcap.inject_pdu.html">inject_pdu</a></span> : <code class="type"><a href="Pcap.html#TYPEiface">iface</a> -> Bitstring.bitstring -> unit</code></pre><div class="info">
<code class="code">inject_pdu iface bits</code> inject the packet <code class="code">bits</code> into interface <code class="code">iface</code>.<br>
</div>
<br>
<span id="2_Packetsniffing"><h2>Packet sniffing</h2></span><br>
<pre><span id="VALpackets_sniffed_ok"><span class="keyword">val</span> <a href="code_VALPcap.packets_sniffed_ok.html">packets_sniffed_ok</a></span> : <code class="type"><a href="Metric.Atomic.html#TYPEt">Metric.Atomic.t</a></code></pre><div class="info">
A counter for how many packets were sniffed.<br>
</div>
<pre><span id="VALbytes_in"><span class="keyword">val</span> <a href="code_VALPcap.bytes_in.html">bytes_in</a></span> : <code class="type"><a href="Metric.Counter.html#TYPEt">Metric.Counter.t</a></code></pre><div class="info">
A counter for how many bytes were sniffed.<br>
</div>
<pre><span id="VALsniffer"><span class="keyword">val</span> <a href="code_VALPcap.sniffer.html">sniffer</a></span> : <code class="type"><a href="Pcap.html#TYPEiface">iface</a> -> (Bitstring.bitstring -> unit) -> Thread.t</code></pre><div class="info">
<code class="code">sniffer iface rx</code> returns a thread that continuously sniff packets
 and pass them to the <code class="code">rx</code> function (via the Clock).<br>
</div>
<br>
<span id="2_Pcapfiles"><h2>Pcap files</h2></span><br>
<pre><span class="keyword">module</span> <a href="Pcap.Dlt.html">Dlt</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Pcap.Dlt.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
<em>Data Link Types</em> are constant values indicating what protocol and hardware technology
 some captured packets were taken from.
</div>
<br><code><span id="TYPEglobal_header"><span class="keyword">type</span> <code class="type"></code>global_header</span> = {</code><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>name&nbsp;: <code class="type">string</code>;</code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" >The file name.</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>endianness&nbsp;: <code class="type">Bitstring.endian</code>;</code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" >Endianess of the file.</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>version_major&nbsp;: <code class="type">int</code>;</code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" >Libpcap version.</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>version_minor&nbsp;: <code class="type">int</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>this_zone&nbsp;: <code class="type">int32</code>;</code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" >Time zone (should be zero, unused).</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>sigfigs&nbsp;: <code class="type">int32</code>;</code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" >unused.</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>snaplen&nbsp;: <code class="type">int32</code>;</code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" >Indicate that no caplen will be smaller. We don't use this.</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>dlt&nbsp;: <code class="type">Dlt.t</code>;</code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" >The Data Link Type (see <a href="Pcap.Dlt.html"><code class="code"><span class="constructor">Pcap</span>.<span class="constructor">Dlt</span></code></a>).</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr></table>
}

<div class="info">
The global header of a pcap file.<br>
</div>

<br>
<span id="3_Capturedpacket"><h3>Captured packet</h3></span><br>
<pre><span class="keyword">module</span> <a href="Pcap.Pdu.html">Pdu</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Pcap.Pdu.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Packets harvested with libpcap will come with additional informations such
 as caplen, timestamp etc.
</div>
<pre><span id="VALsave"><span class="keyword">val</span> <a href="code_VALPcap.save.html">save</a></span> : <code class="type">?caplen:int -> ?dlt:Dlt.t -> string -> Tools.Payload.outer_t -> unit</code></pre><div class="info">
<code class="code">save <span class="string">"file.pcap"</span></code> returns a function that will save passed bitstrings as packets in
 <code class="code"><span class="string">"file.pcap"</span></code>.
<br>
</div>
<div class="param_info"><code class="code">caplen</code> : can be used to cap saved packet to a given number of bytes</div>
<div class="param_info"><code class="code">dlt</code> : can be used to change the file's DLT (required if you do not write Ethernet packets)</div>
<pre><span id="EXCEPTIONNot_a_pcap_file"><span class="keyword">exception</span> Not_a_pcap_file</span></pre>
<div class="info">
When trying to read packets from a file that doesn't look like a pcap file.<br>
</div>
<pre><span id="VALbitstring_of_global_header"><span class="keyword">val</span> <a href="code_VALPcap.bitstring_of_global_header.html">bitstring_of_global_header</a></span> : <code class="type"><a href="Pcap.html#TYPEglobal_header">global_header</a> -> Bitstring.bitstring</code></pre><pre><span id="VALglobal_header_of_bitstring"><span class="keyword">val</span> <a href="code_VALPcap.global_header_of_bitstring.html">global_header_of_bitstring</a></span> : <code class="type">string -> Bitstring.bitstring -> <a href="Pcap.html#TYPEglobal_header">global_header</a></code></pre><pre><span id="VALread_global_header"><span class="keyword">val</span> <a href="code_VALPcap.read_global_header.html">read_global_header</a></span> : <code class="type">string -> <a href="Pcap.html#TYPEglobal_header">global_header</a> * BatIO.input</code></pre><div class="info">
<code class="code">read_global_header filename</code> reads the pcap global header from the
 fiven file, and returns both a <a href="Pcap.html#TYPEglobal_header"><code class="code"><span class="constructor">Pcap</span>.global_header</code></a> and the input channel.<br>
</div>
<pre><span id="VALread_next_pkt"><span class="keyword">val</span> <a href="code_VALPcap.read_next_pkt.html">read_next_pkt</a></span> : <code class="type"><a href="Pcap.html#TYPEglobal_header">global_header</a> -> Batteries.IO.input -> <a href="Pcap.Pdu.html#TYPEt">Pdu.t</a></code></pre><div class="info">
<code class="code">read_next_pkt global_header ic</code> will return the next <a href="Pcap.Pdu.html#TYPEt"><code class="code"><span class="constructor">Pcap</span>.<span class="constructor">Pdu</span>.t</code></a> that's to
 be read from the input stream <code class="code">ic</code>.<br>
</div>
<pre><span id="VALenum_of_file"><span class="keyword">val</span> <a href="code_VALPcap.enum_of_file.html">enum_of_file</a></span> : <code class="type">string -> <a href="Pcap.Pdu.html#TYPEt">Pdu.t</a> Batteries.Enum.t</code></pre><div class="info">
From a pcap file, returns an <code class="code"><span class="constructor">Enum</span>.t</code> of <a href="Pcap.Pdu.html#TYPEt"><code class="code"><span class="constructor">Pcap</span>.<span class="constructor">Pdu</span>.t</code></a>.<br>
</div>
<pre><span id="VALwrite_global_header"><span class="keyword">val</span> <a href="code_VALPcap.write_global_header.html">write_global_header</a></span> : <code class="type">string -> <a href="Pcap.html#TYPEglobal_header">global_header</a> -> unit BatIO.output</code></pre><div class="info">
<code class="code">write_global_header filename</code> write a 'generic' pcap global header and
 returns the output channel.<br>
</div>
<pre><span id="VALwrite_next_pkt"><span class="keyword">val</span> <a href="code_VALPcap.write_next_pkt.html">write_next_pkt</a></span> : <code class="type">unit BatIO.output -> <a href="Pcap.Pdu.html#TYPEt">Pdu.t</a> -> unit</code></pre><div class="info">
<code class="code">write_next_pkt global_header ic</code> will return the next <a href="Pcap.Pdu.html#TYPEt"><code class="code"><span class="constructor">Pcap</span>.<span class="constructor">Pdu</span>.t</code></a> that's to
 be read from the input stream <code class="code">ic</code>.<br>
</div>
<pre><span id="VALfile_of_enum"><span class="keyword">val</span> <a href="code_VALPcap.file_of_enum.html">file_of_enum</a></span> : <code class="type">string -> ?dlt:Dlt.t -> <a href="Pcap.Pdu.html#TYPEt">Pdu.t</a> Batteries.Enum.t -> unit</code></pre><div class="info">
<code class="code">file_of_enum filename e</code> will save an <code class="code"><span class="constructor">Enum</span>.t</code> of <a href="Pcap.Pdu.html#TYPEt"><code class="code"><span class="constructor">Pcap</span>.<span class="constructor">Pdu</span>.t</code></a> into the file named <code class="code">filename</code>.<br>
</div>
<br>
<span id="2_Tools"><h2>Tools</h2></span><br>
<br><code><span id="TYPEinfos"><span class="keyword">type</span> <code class="type"></code>infos</span> = {</code><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>filename&nbsp;: <code class="type">string</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>data_link_type&nbsp;: <code class="type">Dlt.t</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>num_packets&nbsp;: <code class="type">int</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>data_size&nbsp;: <code class="type">int64</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>start_time&nbsp;: <code class="type">Clock.Time.t</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code>stop_time&nbsp;: <code class="type">Clock.Time.t</code>;</code></td>

</tr></table>
}

<div class="info">
Informations on a pcap file.<br>
</div>

<pre><span id="VALinfos_of"><span class="keyword">val</span> <a href="code_VALPcap.infos_of.html">infos_of</a></span> : <code class="type">string -> <a href="Pcap.html#TYPEinfos">infos</a></code></pre><div class="info">
Return some informations about a pcap file (require to scan the whole file,
 so depending on the file size it may take some time).<br>
</div>
<pre><span id="VALmerge"><span class="keyword">val</span> <a href="code_VALPcap.merge.html">merge</a></span> : <code class="type"><a href="Pcap.Pdu.html#TYPEt">Pdu.t</a> Batteries.Enum.t list -> <a href="Pcap.Pdu.html#TYPEt">Pdu.t</a> Batteries.Enum.t</code></pre><div class="info">
<code class="code">merge [e1 ; e2 ; e3]</code> will merge the three <code class="code"><span class="constructor">Enumt</span>.t</code> of packets in chronological
 order.<br>
</div>
<pre><span id="VALrepair_file"><span class="keyword">val</span> <a href="code_VALPcap.repair_file.html">repair_file</a></span> : <code class="type">string -> unit</code></pre><div class="info">
Small utility that truncate a pcap file to the last valid packet.
 Useful for those interrupted/damaged pcap files with an incomplete packet at the end,
 that some tools then refuse to read.<br>
</div>
<pre><span id="VALplay"><span class="keyword">val</span> <a href="code_VALPcap.play.html">play</a></span> : <code class="type">(Bitstring.bitstring -> 'a) -> string -> unit</code></pre><div class="info">
<code class="code">play tx <span class="string">"file.pcap"</span></code> will read packets from <code class="code"><span class="string">"file.pcap"</span></code> and send them to <code class="code">tx</code>
 copying the pcap file frame rate. Notice that we use the internal
 <a href="Clock.html"><code class="code"><span class="constructor">Clock</span></code></a> for this, so it's both very accurate or not accurate at all,
 depending on how you look at it.<br>
</div>
</body></html>