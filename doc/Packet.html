<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link href="http://fonts.googleapis.com/css?family=Rosarivo:400,400italic|Happy+Monkey|Electrolize" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Opache.html">
<link rel="next" href="Pcap.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Arp" rel="Chapter" href="Arp.html">
<link title="Browser" rel="Chapter" href="Browser.html">
<link title="Clock" rel="Chapter" href="Clock.html">
<link title="Dhcp" rel="Chapter" href="Dhcp.html">
<link title="Dhcpd" rel="Chapter" href="Dhcpd.html">
<link title="Dns" rel="Chapter" href="Dns.html">
<link title="Eth" rel="Chapter" href="Eth.html">
<link title="Host" rel="Chapter" href="Host.html">
<link title="Html" rel="Chapter" href="Html.html">
<link title="Http" rel="Chapter" href="Http.html">
<link title="Hub" rel="Chapter" href="Hub.html">
<link title="Icmp" rel="Chapter" href="Icmp.html">
<link title="Ip" rel="Chapter" href="Ip.html">
<link title="Localhost" rel="Chapter" href="Localhost.html">
<link title="Log" rel="Chapter" href="Log.html">
<link title="Metric" rel="Chapter" href="Metric.html">
<link title="Myadmin" rel="Chapter" href="Myadmin.html">
<link title="Net" rel="Chapter" href="Net.html">
<link title="Opache" rel="Chapter" href="Opache.html">
<link title="Packet" rel="Chapter" href="Packet.html">
<link title="Pcap" rel="Chapter" href="Pcap.html">
<link title="Peg" rel="Chapter" href="Peg.html">
<link title="Persist" rel="Chapter" href="Persist.html">
<link title="Router" rel="Chapter" href="Router.html">
<link title="Sim" rel="Chapter" href="Sim.html">
<link title="Sll" rel="Chapter" href="Sll.html">
<link title="Tcp" rel="Chapter" href="Tcp.html">
<link title="Tools" rel="Chapter" href="Tools.html">
<link title="Udp" rel="Chapter" href="Udp.html">
<link title="Url" rel="Chapter" href="Url.html">
<link title="Vlan" rel="Chapter" href="Vlan.html"><link title="Captured packet" rel="Section" href="#2_Capturedpacket">
<link title="Shorthands" rel="Section" href="#2_Shorthands">
<title>Packet</title>
</head>
<body>
<div class="navbar"><a href="Opache.html">Previous</a>
&nbsp;<a href="index.html">Up</a>
&nbsp;<a href="Pcap.html">Next</a>
</div>
<center><h1>Module <a href="type_Packet.html">Packet</a></h1></center>
<br>
<pre><span class="keyword">module</span> Packet: <code class="code"><span class="keyword">sig</span></code> <a href="Packet.html">..</a> <code class="code"><span class="keyword">end</span></code></pre>Packet scrutiny
<p>

The purpose of this module is to help individual packet inquiry and
manipulation by offering an <em>unpacked</em> view of a single packet.
It is not used when simulating a network.
<p>

This is the module to look for if you want to fiddle with packets on a
one to one basis, for instance to fuzz some packet source, collect some
statistics on individual packets, search for some packets in a pcap file,
etc...
<p>

Due to the fact that every packet is considered in isolation, it can only
decode the simplest protocols for which all required data fits within a
single packet. In other words, it will not venture much deeper than TCP/UDP.
<p>

<span id="1_Examples"><h1>Examples</h1></span>
<p>

<span id="2_Exploringapcapfile"><h2>Exploring a pcap file</h2></span>
<p>

This module is more useful from the toplevel <code class="code">robinet.top</code>.
Suppose you have this huge <a href="http://www.tcpdump.org">pcap</a> file
of several tens of gigabyte, and we want to get some idea of what's
in there. We start with the obvious:
<p>

<pre></pre><code class="code"><span class="keywordsign">#</span>&nbsp;<span class="constructor">Pcap</span>.infos_of&nbsp;<span class="string">"big_one.pcap"</span>;;</code><pre></pre>
<pre></pre><code class="code">-&nbsp;:&nbsp;<span class="constructor">Pcap</span>.infos&nbsp;=<br>
{<span class="constructor">Pcap</span>.filename&nbsp;=&nbsp;<span class="string">"big_one.pcap"</span>;&nbsp;<span class="constructor">Pcap</span>.data_link_type&nbsp;=&nbsp;1l;<br>
&nbsp;<span class="constructor">Pcap</span>.num_packets&nbsp;=&nbsp;53993956;&nbsp;<span class="constructor">Pcap</span>.data_size&nbsp;=&nbsp;40756596469<span class="constructor">L</span>;<br>
&nbsp;<span class="constructor">Pcap</span>.start_time&nbsp;=&nbsp;1323766040.99259496;&nbsp;<span class="constructor">Pcap</span>.stop_time&nbsp;=&nbsp;1323767137.688411}<br>
</code><pre></pre>
<p>

This will take a significant amount of time since the whole pcap file
must be scanned.
<p>

Now we are interrested in all the packets attempting to connect port 80:
<p>

<pre></pre><code class="code"><span class="keywordsign">#</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">Packet</span>;;<br>
<span class="keywordsign">#</span>&nbsp;<span class="keyword">let</span>&nbsp;s80&nbsp;=&nbsp;enum_of_file&nbsp;<span class="string">"big_one.pcap"</span>&nbsp;//<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">function</span>&nbsp;[_;_;_;_;&nbsp;<span class="constructor">Pdu</span>.<span class="constructor">Tcp</span>&nbsp;{&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.dst_port&nbsp;=&nbsp;p&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.flags&nbsp;=&nbsp;{&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.syn&nbsp;=&nbsp;<span class="keyword">true</span>&nbsp;;&nbsp;_&nbsp;}&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;}]&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;p&nbsp;=&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Port</span>.o&nbsp;80<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">false</span>;;<br>
<span class="keyword">val</span>&nbsp;s80&nbsp;:&nbsp;<span class="constructor">Packet</span>.<span class="constructor">Pdu</span>.layer&nbsp;list&nbsp;<span class="constructor">BatEnum</span>.t&nbsp;=&nbsp;&lt;abstr&gt;<br>
</code><pre></pre>
<p>

This will return surprisingly fast, due to the lazy nature of Enum.filter.
Note that in this exemple, for brevety, I pattern match for Tcp in 5th
position only (since my big_file.pcap have a 802.1q tunnel between Ethernet
and IP).
<p>

Let us have a look at the first of them:
<p>

<pre></pre><code class="code"><span class="keywordsign">#</span>&nbsp;<span class="constructor">Enum</span>.peek&nbsp;s80;;</code><pre></pre>
<pre></pre><code class="code">-&nbsp;:&nbsp;<span class="constructor">Packet</span>.<span class="constructor">Pdu</span>.layer&nbsp;list&nbsp;option&nbsp;=<br>
<span class="constructor">Some</span><br>
&nbsp;[<span class="constructor">Packet</span>.<span class="constructor">Pdu</span>.<span class="constructor">Pcap</span><br>
&nbsp;&nbsp;&nbsp;{<span class="constructor">Pcap</span>.<span class="constructor">Pdu</span>.source_name&nbsp;=&nbsp;<span class="string">"big_one.pcap"</span>;&nbsp;<span class="constructor">Pcap</span>.<span class="constructor">Pdu</span>.caplen&nbsp;=&nbsp;78;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Pcap</span>.<span class="constructor">Pdu</span>.dlt&nbsp;=&nbsp;<span class="constructor">Ethernet</span>&nbsp;(10<span class="constructor">Mb</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Pcap</span>.<span class="constructor">Pdu</span>.ts&nbsp;=&nbsp;22:32:18.38;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Pcap</span>.<span class="constructor">Pdu</span>.payload&nbsp;=&nbsp;78&nbsp;bytes};<br>
&nbsp;&nbsp;<span class="constructor">Packet</span>.<span class="constructor">Pdu</span>.<span class="constructor">Eth</span><br>
&nbsp;&nbsp;&nbsp;{<span class="constructor">Eth</span>.<span class="constructor">Pdu</span>.src&nbsp;=&nbsp;<span class="constructor">Cisco</span>:1d:6d:01;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Eth</span>.<span class="constructor">Pdu</span>.dst&nbsp;=&nbsp;<span class="constructor">Cisco</span>:4d:5c:01;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Eth</span>.<span class="constructor">Pdu</span>.proto&nbsp;=&nbsp;<span class="constructor">Eth8021q</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Eth</span>.<span class="constructor">Pdu</span>.payload&nbsp;=&nbsp;64&nbsp;bytes};<br>
&nbsp;&nbsp;<span class="constructor">Packet</span>.<span class="constructor">Pdu</span>.<span class="constructor">Vlan</span><br>
&nbsp;&nbsp;&nbsp;{<span class="constructor">Vlan</span>.<span class="constructor">Pdu</span>.prio&nbsp;=&nbsp;0;&nbsp;<span class="constructor">Vlan</span>.<span class="constructor">Pdu</span>.cfi&nbsp;=&nbsp;<span class="keyword">false</span>;&nbsp;<span class="constructor">Vlan</span>.<span class="constructor">Pdu</span>.id&nbsp;=&nbsp;250;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Vlan</span>.<span class="constructor">Pdu</span>.proto&nbsp;=&nbsp;<span class="constructor">IP</span>;&nbsp;<span class="constructor">Vlan</span>.<span class="constructor">Pdu</span>.payload&nbsp;=&nbsp;60&nbsp;bytes};<br>
&nbsp;&nbsp;<span class="constructor">Packet</span>.<span class="constructor">Pdu</span>.<span class="constructor">Ip</span><br>
&nbsp;&nbsp;&nbsp;{<span class="constructor">Ip</span>.<span class="constructor">Pdu</span>.tos&nbsp;=&nbsp;0;&nbsp;<span class="constructor">Ip</span>.<span class="constructor">Pdu</span>.tot_len&nbsp;=&nbsp;60;&nbsp;<span class="constructor">Ip</span>.<span class="constructor">Pdu</span>.id&nbsp;=&nbsp;25178;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ip</span>.<span class="constructor">Pdu</span>.dont_frag&nbsp;=&nbsp;<span class="keyword">true</span>;&nbsp;<span class="constructor">Ip</span>.<span class="constructor">Pdu</span>.more_frags&nbsp;=&nbsp;<span class="keyword">false</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ip</span>.<span class="constructor">Pdu</span>.frag_offset&nbsp;=&nbsp;0;&nbsp;<span class="constructor">Ip</span>.<span class="constructor">Pdu</span>.ttl&nbsp;=&nbsp;62;&nbsp;<span class="constructor">Ip</span>.<span class="constructor">Pdu</span>.proto&nbsp;=&nbsp;tcp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ip</span>.<span class="constructor">Pdu</span>.src&nbsp;=&nbsp;193.51.52.41;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ip</span>.<span class="constructor">Pdu</span>.dst&nbsp;=&nbsp;91.202.200.31;&nbsp;<span class="constructor">Ip</span>.<span class="constructor">Pdu</span>.options&nbsp;=&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Ip</span>.<span class="constructor">Pdu</span>.payload&nbsp;=&nbsp;40&nbsp;bytes};<br>
&nbsp;&nbsp;<span class="constructor">Packet</span>.<span class="constructor">Pdu</span>.<span class="constructor">Tcp</span><br>
&nbsp;&nbsp;&nbsp;{<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.src_port&nbsp;=&nbsp;44994;&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.dst_port&nbsp;=&nbsp;www;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.seq_num&nbsp;=&nbsp;0xC7A42126;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.ack_num&nbsp;=&nbsp;0x00000000;&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.win_size&nbsp;=&nbsp;5840;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.flags&nbsp;=&nbsp;<span class="constructor">Syn</span>;&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.checksum&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;38264;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.urg_ptr&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.options&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;02&nbsp;04&nbsp;05&nbsp;64&nbsp;01&nbsp;01&nbsp;08&nbsp;0a&nbsp;-&nbsp;8c&nbsp;61&nbsp;60&nbsp;83&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;&nbsp;...d.....a......<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;01&nbsp;03&nbsp;03&nbsp;07&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Tcp</span>.<span class="constructor">Pdu</span>.payload&nbsp;=&nbsp;empty}]<br>
</code><pre></pre><br>
<hr width="100%">
<br>
<span id="2_Capturedpacket"><h2>Captured packet</h2></span><br>
<pre><span class="keyword">module</span> <a href="Packet.Pdu.html">Pdu</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Packet.Pdu.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Pack/Unpack the whole protocol stack that fits entirely within a packet.
</div>
<br>
<span id="2_Shorthands"><h2>Shorthands</h2></span><br>
<pre><span id="VALenum_of_file"><span class="keyword">val</span> <a href="code_VALPacket.enum_of_file.html">enum_of_file</a></span> : <code class="type">string -> <a href="Packet.Pdu.html#TYPElayer">Pdu.layer</a> list BatEnum.t</code></pre><div class="info">
<code class="code"><span class="constructor">Packet</span>.enum_of_file filename</code> reads a pcap file and returns an <code class="code"><span class="constructor">Enum</span>.t</code> of <a href="Packet.Pdu.html#TYPEt"><code class="code"><span class="constructor">Packet</span>.<span class="constructor">Pdu</span>.t</code></a>.<br>
</div>
</body></html>